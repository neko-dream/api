#!/bin/bash
#MISE description="未使用のSQLクエリを一覧表示"

find internal/infrastructure/persistence/sqlc/queries -name "*.sql" -type f 2>/dev/null | sort | while read -r file; do
    # Extract lines that match the pattern: -- name: Name :type
    grep -E "^-- name: [a-zA-Z0-9_]+ :(one|many|exec|execresult|execrows|execlastid|batchexec|batchmany|batchone|copyfrom)" "$file" 2>/dev/null | while read -r line; do
        echo "$line"
    done
done | go run cmd/tools/analyze-sql-usage/main.go
