# 退会機能 API仕様書

## 概要

ユーザーの退会と復活機能に関するAPI仕様です。退会後30日以内は復活可能で、31日以降は完全に削除されます。

## 退会フロー

### 1. 退会処理

#### エンドポイント

- 要認証
- ユーザー登録を完了していない場合退会不可

```
DELETE /user
```

#### フロー

1. 一般ユーザーとしてログイン
2. `DELETE /user` を実行
3. ユーザーのステータスが「退会」に変更される

#### レスポンス例

```json
{
  "message": "退会処理が完了しました。30日以内であれば再ログインで復活できます。",
  "withdrawalDate": "2025-08-17T11:50:27+09:00"
}
```

## 復活フロー（退会後30日以内）

### 復活の条件

退会後30日以内にログインした場合、ユーザーは復活可能。

### フロー

1. **通常のログイン処理を実行**
   - 認証自体は成功する
   - Cookieが発行される

2. **保護されたエンドポイントへのアクセス時**
   - ログインが必要なエンドポイントにアクセスすると `AUTH-0010` エラーが返される

   ```json
   {
     "error": {
       "code": "AUTH-0010",
       "message": "アカウントが退会済みです。復活するには /auth/reactivate を実行してください"
     }
   }
   ```

3. **アカウント復活**

#### 復活用エンドポイント

- 要認証

```
POST /auth/reactivate
```

#### 認証

- Cookie認証が必要

#### レスポンス

```json
{
  "message": "アカウントが復活しました",
  "user": {
    "displayID": "example_user",
    "displayName": "user_123456",
    "iconUrl": "https://example.com/icon.jpg"
  }
}
```

## 31日以降のログイン

### 動作

退会後31日を経過した場合、ユーザーデータは完全に削除され、新規登録と同じフローになります。

### フロー

1. 通常のログインを試みる
2. システムは新規ユーザーとして扱う
3. 新規登録フローへ誘導される

## エラーコード一覧

| コード    | 説明                                       | 対処法                    |
| --------- | ------------------------------------------ | ------------------------- |
| AUTH-0010 | 退会済みアカウントでの保護リソースアクセス | `/auth/reactivate` で復活 |
| AUTH-0011 | 復活期限切れ                               | 新規登録が必要            |
| AUTH-0012 | 復活処理失敗                               | 時間をおいて再試行        |

## 組織アカウントについて

### アカウントの見え方

1. 組織のユーザー一覧から消える
2. 復活すると戻る
